
################################
## create index for GTF files ##
################################

# export PATH="/bi/group/reik/ricard/data/software:$PATH"

# gtf_transposable_elements="/bi/group/reik/ricard/data/hg38_sequence/transposable_elements/GRCh38_Ensembl_rmsk_TE.chr.gtf"
# gtf_genes="/bi/group/reik/ricard/data/ensembl/human/v87/GTF/Homo_sapiens.GRCh38.87.chr.gtf"
# job 25 1 "TEtranscripts_indexer --afile $gtf_genes --itype gene"
# job 25 1 "TEtranscripts_indexer --afile $gtf_transposable_elements --itype TE"

##############
## Settings ##
##############

gtf_transposable_elements="/bi/group/reik/ricard/data/hg38_sequence/transposable_elements/GRCh38_Ensembl_rmsk_TE.chr.gtf.ind"
gtf_genes="/bi/group/reik/ricard/data/ensembl/human/v87/GTF/Homo_sapiens.GRCh38.87.chr.gtf.ind"

samples=( "lane1_int_O1mC_D10_exp2_TCAGGAGG_L001_3536STDY9295588" "lane1_int_O1mC_D13_exp2_TTCAGCTC_L001_3536STDY9295597" "lane1_int_O1mC_D15_exp2_TCTACGAC_L001_3536STDY9295606" "lane1_int_O1mC_D17_exp2_TGAAGCCA_L001_3536STDY9295615" "lane1_int_O1pC_D10_exp2_TCTCACGG_L001_3536STDY9295587" "lane1_int_O1pC_D13_exp2_TACTAGTC_L001_3536STDY9295596" "lane1_int_O1pC_D15_exp2_TTGCGTAC_L001_3536STDY9295605" "lane1_int_O1pC_D17_exp2_TTGTTCCA_L001_3536STDY9295614" "lane1_int_O1pS_D10_exp2_TACTTCGG_L001_3536STDY9295586" "lane1_int_O1pS_D13_exp2_TCAGATTC_L001_3536STDY9295595" "lane1_int_O1pS_D15_exp2_TTCGCACC_L001_3536STDY9295604" "lane1_int_O1pS_D17_exp2_TCTCTTCA_L001_3536STDY9295613" "lane1_int_O2mC_D10_exp2_TGTATGCG_L001_3536STDY9295591" "lane1_int_O2mC_D13_exp2_TTACTCGC_L001_3536STDY9295600" "lane1_int_O2mC_D15_exp2_TCATCCTA_L001_3536STDY9295609" "lane1_int_O2mC_D17_exp2_GGTGAGTT_L001_3536STDY9295618" "lane1_int_O2pC_D10_exp2_TCCAGTCG_L001_3536STDY9295590" "lane1_int_O2pC_D13_exp2_TATGTGGC_L001_3536STDY9295599" "lane1_int_O2pC_D15_exp2_TAGAACAC_L001_3536STDY9295608" "lane1_int_O2pC_D17_exp2_TGCGTGAA_L001_3536STDY9295617" "lane1_int_O2pS_D10_exp2_TAAGTTCG_L001_3536STDY9295589" "lane1_int_O2pS_D13_exp2_TGTCTATC_L001_3536STDY9295598" "lane1_int_O2pS_D15_exp2_TGACAGAC_L001_3536STDY9295607" "lane1_int_O2pS_D17_exp2_TACCACCA_L001_3536STDY9295616" "lane1_int_O3mC_D10_exp2_TATGCCAG_L001_3536STDY9295594" "lane1_int_O3mC_D13_exp2_TGTTCTCC_L001_3536STDY9295603" "lane1_int_O3mC_D15_exp2_TGTGAAGA_L001_3536STDY9295612" "lane1_int_O3mC_D17_exp2_GACGGATT_L001_3536STDY9295621" "lane1_int_O3pC_D10_exp2_TGGCTCAG_L001_3536STDY9295593" "lane1_int_O3pC_D13_exp2_TACCGAGC_L001_3536STDY9295602" "lane1_int_O3pC_D15_exp2_TAGACGGA_L001_3536STDY9295611" "lane1_int_O3pC_D17_exp2_GTGTCCTT_L001_3536STDY9295620" "lane1_int_O3pS_D10_exp2_TCATTGAG_L001_3536STDY9295592" "lane1_int_O3pS_D13_exp2_TCGTTAGC_L001_3536STDY9295601" "lane1_int_O3pS_D15_exp2_TGCTGATA_L001_3536STDY9295610" "lane1_O1_fib_exp2_TTCCATTG_L001_3536STDY9295581" "lane1_O1mC_D10_exp2_TTAGGCAT_L001_3536STDY9295552" "lane1_O1mC_D13_CGATGTTT_L001_3536STDY7982604" "lane1_O1mC_D13_exp2_GGCTACAG_L001_3536STDY9295560" "lane1_O1mC_D15_exp2_TCTGCTGT_L001_3536STDY9295568" "lane1_O1mC_D15_TAGCTTGT_L001_3536STDY7982612" "lane1_O1mC_D17_TTCTGTGT_L001_3536STDY7982620" "lane1_O1pC_D13_ATCACGTT_L001_3536STDY7982603" "lane1_O1pC_D13_exp2_TAGCTTGT_L001_3536STDY9295559" "lane1_O1pC_D15_exp2_TTCTGTGT_L001_3536STDY9295567" "lane1_O1pC_D15_GATCAGCG_L001_3536STDY7982611" "lane1_O1pC_D17_exp2_TGCGATCT_L001_3536STDY9295574" "lane1_O1pC_D17_TGTACCTT_L001_3536STDY7982619" "lane1_O1pS_D10_exp2_ATCACGTT_L001_3536STDY9295550" "lane1_O1pS_D17_TCCGTCTT_L001_3536STDY7982618" "lane1_O2mC_D10_exp2_GCCAATGT_L001_3536STDY9295555" "lane1_O2mC_D13_ACAGTGGT_L001_3536STDY7982607" "lane1_O2mC_D13_exp2_TCTCGGTT_L001_3536STDY9295563" "lane1_O2mC_D15_CTTGTACT_L001_3536STDY7982614" "lane1_O2mC_D15_exp2_TCGAGCGT_L001_3536STDY9295570" "lane1_O2mC_D17_exp2_TACAGGAT_L001_3536STDY9295577" "lane1_O2mC_D17_TCGAGCGT_L001_3536STDY7982623" "lane1_O2pC_D10_exp2_ACAGTGGT_L001_3536STDY9295554" "lane1_O2pC_D13_exp2_TGGTTGTT_L001_3536STDY9295562" "lane1_O2pC_D13_TGACCACT_L001_3536STDY7982606" "lane1_O2pC_D15_GGCTACAG_L001_3536STDY7982613" "lane1_O2pC_D17_exp2_TAGTGACT_L001_3536STDY9295576" "lane1_O2pC_D17_TTGGAGGT_L001_3536STDY7982622" "lane1_O2pS_D10_exp2_TGACCACT_L001_3536STDY9295553" "lane1_O2pS_D13_exp2_CTTGTACT_L001_3536STDY9295561" "lane1_O2pS_D13_TTAGGCAT_L001_3536STDY7982605" "lane1_O2pS_D17_TCTGCTGT_L001_3536STDY7982621" "lane1_O3_fib_exp2_TAACGCTG_L001_3536STDY9295583" "lane1_O3mC_D13_ACTTGATG_L001_3536STDY7982610" "lane1_O3mC_D13_exp2_TGTACCTT_L001_3536STDY9295566" "lane1_O3mC_D15_exp2_TTGACTCT_L001_3536STDY9295573" "lane1_O3mC_D15_TAAGCGTT_L001_3536STDY7982617" "lane1_O3mC_D17_exp2_TAGTCTTG_L001_3536STDY9295580" "lane1_O3mC_D17_TTGACTCT_L001_3536STDY7982626" "lane1_O3pC_D10_exp2_ACTTGATG_L001_3536STDY9295557" "lane1_O3pC_D13_CAGATCTG_L001_3536STDY7982609" "lane1_O3pC_D13_exp2_TCCGTCTT_L001_3536STDY9295565" "lane1_O3pC_D15_TCTCGGTT_L001_3536STDY7982616" "lane1_O3pC_D17_exp2_TGTGGTTG_L001_3536STDY9295579" "lane1_O3pC_D17_TGCATAGT_L001_3536STDY7982625" "lane1_O3pS_D10_exp2_CAGATCTG_L001_3536STDY9295556" "lane1_O3pS_D13_exp2_TAAGCGTT_L001_3536STDY9295564" "lane1_O3pS_D13_GCCAATGT_L001_3536STDY7982608" "lane1_O3pS_D15_exp2_TGATACGT_L001_3536STDY9295571" "lane1_O3pS_D15_TGGTTGTT_L001_3536STDY7982615" "lane1_O3pS_D17_exp2_TCCTCAAT_L001_3536STDY9295578" "lane1_O3pS_D17_TGATACGT_L001_3536STDY7982624" "lane1_repeat_ipsc_13_exp2_GTTAGCCT_L001_3536STDY9826478" "lane1_repeat_ipsc_21_exp2_GTCGCTAT_L001_3536STDY9826479" "lane1_repeat_O1mC_D17_exp2_GAGGTGCT_L001_3536STDY9826476" "lane1_repeat_O1pC_D10_exp2_GCAACATT_L001_3536STDY9826472" "lane1_repeat_O2_fib_exp2_GCATGGCT_L001_3536STDY9826477" "lane1_repeat_O2pC_D15_exp2_GAATCTGT_L001_3536STDY9826474" "lane1_repeat_O3mC_D10_exp2_GGTCGTGT_L001_3536STDY9826473" "lane1_repeat_O3pC_D15_exp2_GTACATCT_L001_3536STDY9826475" )

################################
## create index for bam files ##
################################

cd /bi/group/reik/ricard/data/Gill2022_human_fibroblast_rejuvenation/star

i="lane1_O3mC_D17_exp2_TAGTCTTG_L001_3536STDY9295580"
for i in "${samples[@]}"; do
	if ! [ -f "${i}_Aligned.sortedByCoord.out.bam.bai" ]; then
		echo $i
	    job 10 1 "samtools index ${i}_Aligned.sortedByCoord.out.bam"
	fi
done

#############
## TEcount ##
#############

bam_dir="/bi/group/reik/ricard/data/Gill2022_human_fibroblast_rejuvenation/star"
outdir="/bi/group/reik/ricard/data/Gill2022_human_fibroblast_rejuvenation/TEcounts"

# i="lane1_int_O1mC_D10_exp2_TCAGGAGG_L001_3536STDY9295588"
for i in "${samples[@]}"; do

	if ! [ -f "${i}.cntTable" ]; then
		echo $i
		file="${bam_dir}/${i}_Aligned.sortedByCoord.out.bam"
		cmd="TEcount --GTF $gtf_genes --TE $gtf_transposable_elements --sortByPos --format BAM --mode multi -b $file --project $i --outdir $outdir"
	    job 40 1 "$cmd"
	fi
done

